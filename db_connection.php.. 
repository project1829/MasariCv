<?php
// db_connection.php

// --- إعدادات قاعدة البيانات ---
// !! تأكد من أن هذه القيم تطابق إعدادات XAMPP لديك !!
$db_host = 'localhost';         // عادةً ما يكون 'localhost' في XAMPP
$db_name = 'masari_db';       // اسم قاعدة البيانات التي أنشأتها في phpMyAdmin
$db_user = 'root';            // اسم المستخدم الافتراضي لـ MySQL في XAMPP هو 'root'
$db_pass = '';                // كلمة المرور الافتراضية لـ 'root' في XAMPP عادةً ما تكون فارغة.
                              // إذا قمت بتعيين كلمة مرور لـ root، فضعها هنا.
$charset = 'utf8mb4';         // لضمان دعم اللغة العربية بشكل كامل

// --- إنشاء اتصال PDO ---
// PDO هو الأسلوب الموصى به للتعامل مع قواعد البيانات في PHP لأمانه ومرونته.

// DSN (Data Source Name) - يصف كيفية الاتصال بقاعدة البيانات
$dsn = "mysql:host=$db_host;dbname=$db_name;charset=$charset";

// خيارات اتصال PDO
$options = [
    // عرض الأخطاء كاستثناءات برمجية لتسهيل التصحيح أثناء التطوير
    PDO::ATTR_ERRMODE            => PDO::ERRMODE_EXCEPTION,
    // جلب البيانات كمصفوفة ترابطية (اسم العمود => القيمة) بشكل افتراضي
    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
    // تعطيل محاكاة الاستعلامات المُعدّة لاستخدام الاستعلامات الحقيقية (أكثر أماناً)
    PDO::ATTR_EMULATE_PREPARES   => false,
];

// محاولة الاتصال بقاعدة البيانات
try {
    // إنشاء كائن PDO جديد (وهو يمثل الاتصال)
    $pdo = new PDO($dsn, $db_user, $db_pass, $options);
    // إذا وصلت إلى هنا، فالاتصال ناجح.
    // المتغير $pdo جاهز للاستخدام في ملفات PHP الأخرى التي تحتاج إلى تفاعل مع قاعدة البيانات.

} catch (\PDOException $e) {
    // في حالة فشل الاتصال، يتم التقاط الاستثناء هنا.

    // **هام:** في بيئة الإنتاج الحقيقية، لا تعرض رسالة الخطأ المفصلة للمستخدم أبداً!
    // بدلاً من ذلك، قم بتسجيل الخطأ في ملف سجلات الخادم وقدم رسالة عامة للمستخدم.

    // تسجيل الخطأ في سجل أخطاء PHP (أو ملف مخصص)
    error_log("PDO Connection Error: " . $e->getMessage());

    // عرض رسالة خطأ عامة للمستخدم وإيقاف تنفيذ السكربت
    // يمكنك تخصيص هذه الرسالة أو تصميم صفحة خطأ مخصصة.
    die("عذراً، حدث خطأ فني أثناء محاولة الاتصال بقاعدة البيانات. يرجى المحاولة مرة أخرى لاحقاً أو الاتصال بالدعم الفني.");
}

// لا حاجة لاستدعاء $pdo->close() يدوياً، سيتم إغلاق الاتصال تلقائياً عند انتهاء تنفيذ سكربت PHP.
?>